### Key Manager

> Description: Key Manager manages operations on user PGP/RSA keys.

> Behind the scenes it uses and implements GnuPG wrapper and pgpdump packages.

- GnuPG wrapper **http://pythonhosted.org/gnupg/gnupg.html#gnupg-module** for PGP key manipulations
- pgpdump **https://pypi.python.org/pypi/pgpdump/1.3** for parsing PGP key and retrieve the
            information needed for generating plain RSA key based on PGP key semi-primes

> KeyManager class instantiation accepts GnuPG home directory path, it is optional and defaults
        to $HOME/.gnupg/ directory though.

List of provided methods:
-------------------------
    - generate_plain_rsa_key
    - get_pgp_rsa_key_id
    - get_pgp_rsa_keys
    - _return_rsa_key_from_pgp
    - compute_rsa_private_key
    - compute_rsa_public_key
    - rsa_private_key_to_pem
    - rsa_public_key_to_pem
    - generate_pgp_key
    - delete_pgp_key
    - _retrieve_local_pgp_keys
    - _retrieve_local_pgp_key_id

> **generate_plain_rsa_key**:
-
        Params: (key_size=2048)
            - (int) RSA key size, defaults to 2048 bits
        Description: Generates plain RSA private key and
            returns cryptography.hazmat.backends.openssl.rsa._RSAPrivateKey object.

> **get_pgp_rsa_key_id**:
-
        Params: (key_id, secret=True)
            - (str) PGP key fingerprint
            - (boolean) On True process private keys, on False public keys
        Description: Returns RSA private key of provided PGP key as a
            cryptography.hazmat.backends.openssl.rsa._RSAPrivateKey object on success, otherwise None.

> **get_pgp_rsa_keys**:
-
        Params: (limit=30, secret=True)
            - (int) limit number how many PGP keys has to be processed, negative number means unlimited
            - (boolean) On True process private keys, on False public keys
        Description: Returns Generator object throughout local PGP key chain as a
            cryptography.hazmat.backends.openssl.rsa.(_RSAPrivateKey|_RSAPublicKey) object.

> _**return_rsa_key_from_pgp**:
-
        Params: (pgp_key, secret)
            - PGP key
            - One True process private keys, on False public keys
        Description: Used internally ("protected" method) to compute and return RSA (private|public) key
        based on PGP key.

> **compute_rsa_private_key**:
-
        Params: (p, q, e, n, d)
            - Prime p
            - Prime q
            - Public exponent
            - Modulus
            - Private key
        Description: Computes RSA private key based on RSA semi-primes (p, q, e, n, d) and returns as
            cryptography.hazmat.backends.openssl.rsa._RSAPrivateKey object.

> **compute_rsa_public_key**:
-
        Params: (e, n)
            - Public exponent
            - Modulus
        Description: Computes RSA public key based on RSA semi-primes returns as
            cryptography.hazmat.backends.openssl.rsa._RSAPublicKey object.

> **rsa_private_key_to_pem**:
-
        Params: (rsa_secret_key)
            - cryptography.hazmat.backends.openssl.rsa._RSAPrivateKey object
        Desciption: Converts and returns RSA private key from cryptography object to PEM format.

> **rsa_public_key_to_pem**:
-
        Params: (rsa_public_key)
            - cryptography.hazmat.backends.openssl.rsa._RSAPublicKey object
        Description: Converts and returns RSA public key from cryptography object to PEM format.

> **generate_pgp_key**:
-
        Params: (key_length=2048, user_name='Auto Generated Key', user_comment='Generated by KeyManager', user_email='')
            - defaults to '2048 bits'
            - defaults to 'Auto Generated Key'
            - defaults to 'Generated by KeyManager'
            - defaults to '<username>@<hostname>'
        Description: Generates PGP key pair based on provided parameters.

> **delete_pgp_key**:
-
        Params: (fingerprint)
            - PGP key fingerprint
        Description: Deletes PGP key pair with the provided PGP key fingerprint.

> _**retrieve_local_pgp_keys**:
-
        Params: (secret_key)
            - On True process private keys, on False public keys.
        Description: Used internally ("Protected" method) to retrieve all the PGP (private/public) keys from local
            PGP key chain.

> _**retrieve_local_pgp_key_id**:
-
        Params: (key_id, secret_key)
            - PGP key fingerprint
            - On True process private keys, on False public keys.
        Description: Used internally ("Protected" method), retrieves PGP (private/public) key with
            the specified fingerprint.

> NB: **test_key_manager.py** provides **100%** coverage unit tests for KeyManager class and on its dependencies.

---

> Usage examples:

```python
import os
from mflod.crypto.key_manager import KeyManager


# Instantiate KeyManager class and defines its instance in a key_manager variable
key_manager = KeyManager(os.environ['HOME'] + '/.gnupg')


# Generates specified key size (512 bits in this case) RSA private key
# Returns => <cryptography.hazmat.backends.openssl.rsa._RSAPrivateKey object at ...>
print(key_manager.generate_plain_rsa_key(512))


# get_pgp_rsa_key_id method usage --------------------------------------------------------------------------------------
# Searches private key with the fingerprint of "fake_key_id" and returns None, since it can't be found
print(key_manager.get_pgp_rsa_key_id('fake_key_id', True))


# Searches public key with the fingerprint of "fake_key_id" and returns None, since it can't be found
print(key_manager.get_pgp_rsa_key_id('fake_key_id', False))


# get_pgp_rsa_keys method usage ----------------------------------------------------------------------------------------
# Iterates through maximum 10 PGP private keys from local key chain
for item in key_manager.get_pgp_rsa_keys(limit=10, secret=True):
    print(item)


# compute_rsa_private_key method usage ---------------------------------------------------------------------------------
# Returns <cryptography.hazmat.backends.openssl.rsa._RSAPrivateKey object at ...>
private_key = key_manager.compute_rsa_private_key(5, 17, 3, 85, 29)
print(private_key)


# compute_rsa_public_key method usage ----------------------------------------------------------------------------------
# Returns <cryptography.hazmat.backends.openssl.rsa._RSAPublicKey object at ...>
public_key = key_manager.compute_rsa_public_key(3, 85)
print(public_key)


# rsa_private_key_to_pem method usage ----------------------------------------------------------------------------------
# Returns b'-----BEGIN RSA PRIVATE KEY-----\nMBsCAQACAVUCAQMCAR0CAQUCARECAQECAQ0CAQM=\n-----END RSA PRIVATE KEY-----\n'
print(key_manager.rsa_private_key_to_pem(private_key))


# rsa_public_key_to_pem method usage -----------------------------------------------------------------------------------
# Returns b'-----BEGIN PUBLIC KEY-----\nMBowDQYJKoZIhvcNAQEBBQADCQAwBgIBVQIBAw==\n-----END PUBLIC KEY-----\n'
print(key_manager.rsa_public_key_to_pem(public_key))


# generate_pgp_key method usage ----------------------------------------------------------------------------------------
# Generates PGP key pair with specified parameters and returns PGP key fingerprint
pgp_key_fingerprint = key_manager.generate_pgp_key(1024, 'test name', 'test comment', 'test@example.com')


# delete_pgp_key method usage ------------------------------------------------------------------------------------------
# Deletes PGP key pair of specified fingerprint, returns None
key_manager.delete_pgp_key(pgp_key_fingerprint)


# NB. Protected method usage (method names starting with _) is not described in examples,
# since they are used internally, though can be called from outside as well.

```
